# ESP8266 SSD1306 智能时钟 - 用户手册

欢迎使用ESP8266 SSD1306智能时钟！本手册将帮助您快速了解和使用本设备的各项功能。

## 目录

1. [产品概述](#产品概述)
2. [快速开始](#快速开始)
3. [基本功能](#基本功能)
4. [高级功能](#高级功能)
5. [按键说明](#按键说明)
6. [设置说明](#设置说明)
7. [故障排除](#故障排除)
8. [常见问题](#常见问题)

## 产品概述

ESP8266 SSD1306智能时钟是一款基于ESP8266微控制器和SSD1306 OLED显示屏的智能时钟设备，具有以下特点：

- 🕐 **精准时间显示**：支持NTP网络时间同步、RTC实时时钟
- 🌐 **WiFi自动连接**：支持WiFiManager配网，自动重连
- 💡 **智能亮度调节**：自动调暗、夜间模式
- 🔋 **省电模式**：自动睡眠，延长使用寿命
- 📊 **状态显示**：实时显示网络状态和信号强度
- 🎨 **多种显示模式**：支持大字体、小字体切换

## 快速开始

### 首次使用

1. **上电启动**
   - 连接电源到ESP8266设备
   - OLED将显示启动画面（时钟图标）
   - 约1秒后显示时间

2. **WiFi配置**（首次使用或重置后）
   - 长按K4键（超过500ms）进入配网模式
   - 在手机/电脑上搜索WiFi热点："Clock_AP_xxxxxxxx"（无需密码）
   - 连接后打开浏览器访问：`192.168.4.1`
   - 选择你的WiFi网络并输入密码
   - 点击"保存"等待连接成功

3. **正常使用**
   - OLED显示当前时间和日期
   - 设备会自动同步网络时间
   - 享受智能时钟带来的便利

### 日常使用

- **查看时间**：正常显示当前时间和日期
- **查看网络状态**：短按K4键（显示5秒后自动消失）
- **切换字体大小**：短按K2键
- **调整亮度**：短按K3键进入亮度设置

## 基本功能

### 时间显示

#### 主界面
- **日期**：显示在上方，格式为"YYYY-MM-DD"
- **时间**：显示在中央，格式为"HH:MM:SS"
- **星期**：显示在右下方，中文格式（周日、周一等）
- **市场日**：显示在左下方（太守、新桥、芦圩）

#### 时间源指示
- `*` (星号)：使用NTP网络时间
- `R` (字母R)：使用RTC实时时钟
- `S` (字母S)：使用软件时钟（手动设置）
- `!` (感叹号)：时间错误或不可用

### 网络状态

#### 查看网络状态
- 短按K4键显示网络信息
- 显示内容包括：
  - WiFi名称
  - IP地址
  - 时间源类型
  - 信号强度
- 5秒后自动消失

#### 时间源说明
- **NTP**：网络时间（需要WiFi连接）
- **RTC**：实时时钟（需要DS1307模块）
- **CLK**：软件时钟（手动设置的时间）

系统会自动选择最佳时间源，优先级：RTC > NTP > CLK

## 高级功能

### 自动亮度调节

#### 自动调暗
- 设备在5分钟无操作后自动降低亮度
- 亮度降低为夜间模式亮度
- 按任意按键恢复正常亮度

#### 夜间模式
- 晚上22:00至早上7:00自动切换到夜间亮度
- 夜间亮度可在设置中调整
- 白天8:00至21:00使用正常亮度

### 自动睡眠

#### 睡眠模式
- 设备在30分钟无操作后进入睡眠模式
- 睡眠模式下OLED关闭，节省电量
- 按任意按键唤醒设备

### 时间源切换

#### 手动切换时间源
1. 长按K2键（超过500ms）进入时间源设置
2. 短按K2键在"NTP"、"RTC"、"CLK"之间切换
3. 短按K4键确认选择
4. 系统会尝试切换到选择的时间源

#### 时间源说明
- **NTP**：需要WiFi连接，时间最准确
- **RTC**：需要DS1307模块，断电后仍可运行
- **CLK**：手动设置的时间，不依赖外部设备

## 按键说明

### 按键布局
```
┌─────────────────┐
│  [K1] [K2]      │
│                 │
│  [K3] [K4]      │
└─────────────────┘
```

### 按键功能

#### K1键
- **亮度设置模式**：增加亮度
- **时间设置模式**：增加当前字段的值

#### K2键
- **正常模式**：短按切换字体大小（大/小）
- **正常模式**：长按进入时间源设置
- **亮度设置模式**：减少亮度
- **时间源设置模式**：切换时间源
- **时间设置模式**：减少当前字段的值

#### K3键
- **正常模式**：短按进入亮度设置
- **正常模式**：长按进入时间设置
- **时间设置模式**：切换设置字段（年/月/日/时/分/秒）

#### K4键
- **正常模式**：短按显示/隐藏网络状态
- **正常模式**：长按重置WiFi进入配网模式
- **亮度设置模式**：确认并退出亮度设置
- **时间源设置模式**：确认并退出时间源设置
- **时间设置模式**：确认并退出时间设置

### 按键操作说明

#### 短按
- 按下并快速释放（小于500ms）

#### 长按
- 按下并保持超过500ms
- 长按会触发特殊功能

#### 重复按键
- 连续短按可以快速调整值
- 在设置模式下特别有用

## 设置说明

### 亮度设置

#### 进入亮度设置
1. 短按K3键进入亮度设置
2. OLED显示"设置亮度"和当前亮度等级

#### 调整亮度
- 短按K1键：增加亮度
- 短按K2键：减少亮度
- 亮度等级：低亮、中亮、高亮、最亮

#### 退出亮度设置
- 短按K4键确认并退出（亮度设置会自动保存）
- 或等待15秒自动退出（亮度设置会自动保存）

**注意**: 亮度设置会自动保存到设备存储中，重启后会自动恢复上次设置的亮度。

### 时间设置

#### 进入时间设置
1. 长按K3键（超过500ms）进入时间设置
2. OLED显示"设置时间"和当前时间

#### 设置时间
- 短按K1键：增加当前字段的值
- 短按K2键：减少当前字段的值
- 短按K3键：切换设置字段
  - 字段顺序：年 → 月 → 日 → 时 → 分 → 秒

#### 字段说明
- **年**：2020-2099
- **月**：1-12
- **日**：1-31（根据月份自动调整）
- **时**：0-23
- **分**：0-59
- **秒**：0-59

#### 退出时间设置
- 短按K4键确认并退出
- 或等待15秒自动退出

### 时间源设置

#### 进入时间源设置
1. 长按K2键（超过500ms）进入时间源设置
2. OLED显示"设置时间源"和可选时间源

#### 选择时间源
- 短按K2键在以下选项中切换：
  - **NTP**：网络时间
  - **RTC**：实时时钟
  - **CLK**：软件时钟

#### 退出时间源设置
- 短按K4键确认并退出
- 或等待15秒自动退出

### 网络重置

#### 重置WiFi配置
1. 长按K4键（超过500ms）重置WiFi
2. OLED显示"配网模式"
3. 等待3秒后进入后台配网
4. 按照首次使用的步骤重新配置WiFi

#### 注意事项
- 重置WiFi会清除所有WiFi配置
- 需要重新连接WiFi网络
- 建议仅在必要时重置

## 故障排除

### OLED不显示

#### 可能原因
1. 电源未连接
2. OLED接线错误
3. 固件未正确上传

#### 解决方法
1. 检查电源连接
2. 检查I2C接线（SCL: D1, SDA: D2）
3. 重新上传固件
4. 按复位按钮重启设备

### WiFi连接失败

#### 可能原因
1. WiFi密码错误
2. 路由器不支持2.4GHz频段
3. WiFi信号太弱

#### 解决方法
1. 长按K4键重置WiFi配置
2. 重新配网时确认WiFi密码正确
3. 确保路由器支持2.4GHz频段
4. 将设备靠近路由器

### 时间显示错误

#### 可能原因
1. 网络未连接
2. NTP服务器不可达
3. RTC模块故障

#### 解决方法
1. 检查网络连接状态（短按K4查看）
2. 尝试手动设置时间
3. 检查RTC模块连接
4. 重启设备

### 按键无响应

#### 可能原因
1. 按键接线错误
2. 按键故障
3. 固件问题

#### 解决方法
1. 检查按键接线
2. 更换故障按键
3. 重新上传固件
4. 重启设备

### 设备频繁重启

#### 可能原因
1. 电源不稳定
2. 看门狗触发
3. 固件问题

#### 解决方法
1. 检查电源供应
2. 使用稳定的电源适配器
3. 重新上传固件
4. 联系技术支持

## 常见问题

### Q: 如何更改WiFi密码？
A: 长按K4键重置WiFi配置，然后重新配网。

### Q: 如何手动设置时间？
A: 长按K3键进入时间设置，使用K1/K2调整时间，K3切换字段，K4确认。

### Q: 设备断电后时间会丢失吗？
A: 如果安装了DS1307 RTC模块，断电后时间不会丢失。如果没有RTC模块，需要重新连接WiFi同步时间。

### Q: 如何关闭自动睡眠功能？
A: 编辑production_config.h文件，将AUTO_SLEEP_TIMEOUT_MS设置为一个很大的值（如86400000，即24小时）。

### Q: 如何更改WiFiManager AP密码？
A: 编辑production_config.h文件，修改WIFI_MANAGER_AP_PASSWORD的值。

### Q: 设备支持OTA固件更新吗？
A: 当前版本不支持OTA更新，需要通过USB上传固件。

### Q: 如何查看设备的运行日志？
A: 使用Arduino IDE的串口监视器，波特率设置为115200。

### Q: 设备支持多少个WiFi网络？
A: 支持连接任意数量的WiFi网络，但只能同时连接一个。

### Q: 如何切换到12小时制显示？
A: 当前版本仅支持24小时制显示。

### Q: 设备的功耗是多少？
A: 正常工作模式约100-150mA，睡眠模式约20-30mA。

### Q: 设备的尺寸和重量？
A: 取决于使用的ESP8266开发板和OLED显示屏，通常为5-10cm x 5-10cm，重量约20-50g。

## 技术支持

如果您遇到本手册未涵盖的问题，请：
1. 查看README.md了解更多信息
2. 提交Issue到GitHub
3. 联系技术支持

## 版本信息

- **当前版本**：v2.1
- **发布日期**：2025-02-03
- **固件大小**：约930KB

## 更新日志

### v2.1 (2025-02-03)
- 新增亮度永久保存功能
- 使用EEPROM存储亮度设置
- 重启后自动恢复上次亮度设置
- 添加EEPROM数据校验机制

### v2.0 (2025-12-23)
- 修复所有已知的16个bug
- 添加所有millis()溢出保护
- 添加所有数组边界检查
- 优化按键消抖逻辑
- 完善错误处理机制
- 添加生产环境配置

### v1.0 (2025-12-20)
- 初始版本
- 基本时钟功能
- WiFi配网
- NTP时间同步

---

感谢您使用ESP8266 SSD1306智能时钟！
